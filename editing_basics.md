# Основы редактирования

Давайте изучим основные команды редактирования в Vim для чтения/записи файлов, вырезания/копирования/вставки, отмены/повтора и поиска.

## Чтение и редактирование файлов

### Буферы

При редактировании файла Vim переносит текст из файла на жестком диске в оперативную память компьютера. Это означает, что копия файла хранится в памяти компьютера и любые внесенные изменения производятся в памяти компьютера и отображаются немедленно. После того, как вы закончили редактирование файла, то можете сохранить файл, что означает, что Vim записывает обратно текст из памяти компьютера в файл на жестком диске. Память компьютера, используемая для временного хранения текста, называется "буфером". Обратите внимание, что эта же концепция является причиной, почему мы должны "сохранять" файлы во всех редакторах или текстовых процессорах, которые мы используем.

Теперь откройте Vim, напишите слова `Hello World` и сохраните их как файл `hello.txt`. Если Вам нужно напомнить как это сделать - обратитеь к [главе Первые шаги](./first_steps.md#write-file).

### Подкачка (swap)

Теперь вы заметите, что другой файл был создан в том же каталоге что и этот, файл будет называться что-то вроде `.hello.txt.swp`. Запустите `:swapname` , чтобы узнать точное имя файла.

Что это за файл? Vim поддерживает резервную копию буфера в файле, который он регулярно сохраняет на жесткий диск, так что в случае, если что-то пойдет не так (например, сбой компьютера или даже сбой Vim), у вас есть резервная копия изменений, внесенных с момента последнего сохранения исходного файла. Этот файл называется "файл подкачки (swap)", потому что Vim постоянно обменивается содержимым буфера в памяти компьютера с содержимым этого файла на жестком диске. Дополнительную информацию смотрите в разделе `:help swap-file`.

### Сохранить мой файл

Теперь, когда файл загружен, давайте сделаем небольшое редактирование. Нажмите клавишу ~ чтобы изменить регистр символа, на котором расположен курсор. Вы заметите, что Vim теперь отмечает файл, который был изменен (например, знак `+` отображается в строке заголовка графической версии Vim). Вы можете открыть фактический файл в другом редакторе и проверить что он еще не изменился, т.е. Vim только изменил буфер и еще не сохранил его на жестком диске.

Мы можем записать буфер обратно в исходный файл на жестком диске, выполнив команду `:write`.

> ПРИМЕЧАНИЕ: Чтобы упростить сохранинени - добавьте следующую строку в файл vimrc:
> <br>
> ``` viml
> " To save, ctrl-s.
> nmap <c-s> :w<CR>
> imap <c-s> <Esc>:w<CR>a
> ```
> <br>
> Теперь вы можете просто нажать `ctrl-s`, чтобы сохранить файл.

### Работа в моем каталоге

Vim запускается с вашим домашним каталогом в качестве каталога по умолчанию, и все операции будут выполняться в нем.

Для открытия файлов, расположенных в других директориях, можно использовать полные или относительные пути, такие как:

``` viml
:e ../tmp/test.txt
:e C:\\shopping\\monday.txt
```

Или вы можете переключить Vim на этот каталог:

``` viml
:cd ../tmp
```

`:cd` - это сокращение от 'c'hange 'd'irectory (смена каталога).

Чтобы узнать текущий каталог, в котором Vim ищет файлы:

``` viml
:pwd
```

`:pwd` - сокращение от 'p'rint 'w'orking 'd'irectory (напечатать рабочий каталог).

## Выразание, копирование и вставка

Как говорит Шон Коннери в фильме [Найти Форрестера](http://www.imdb.com/title/tt0181536/):

> No thinking - that comes later. You must write your first draft with your heart. You rewrite with your head. The first key to writing is... to write, not to think!
> Не думай - это придет позже. Ты должен написать свой первый черновик сердцем. Ты переписываешь с головой. Первый ключ к написанию - это... писать, а не думать!

Когда мы переписываем, мы часто меняем порядок абзацев или предложений, т.е. нам нужно иметь возможность вырезать/копировать/вставлять текст. В Vim мы используем несколько иную терминологию:

| Мир десктопа | Мир Vim | Операция |
| --- | --- | --- |
| cut (вырезать) | delete | `d` |
| copy (копировать)| yank | `y` |
| paste (вставить) | paste | `p` |

В обычной терминологии 'cut'ting (вырезать) текст означает удалить текст и поместить его в буфер обмена. Та же операция в Vim означает, что он удаляет текст из файлового буфера и сохраняет его в "регистре" (часть памяти компьютера). Поскольку мы можем выбрать регистр, в котором можем хранить текст, операция называется "удалить" (delete).

Аналогично, в обычной терминологии "копировать" текст означает, что копия текста помещается в буфер обмена. Vim делает то же самое, он "yanks" (дергает) текст и помещает его в регистр.

"Вставить" (paste) означает то же самое в обеих терминологиях.

Мы видели как вы можете выполнять операции вырезания/копирования/вставки в Vim. Но как вы определяете, с каким текстом должны работать эти операции? Мы уже исследовали это в предыдущем [разделе Части текста](./moving_around.md#text-objects).

Сочетание нотации операции и нотации объекта текста означает, что у нас есть бесчисленные способы манипулирования текстом. Давайте рассмотрим несколько примеров.

Напишите этот текст в Vim (точно так, как показано):

<!-- Combining the operation notation and the text object notation means we have innumerable ways of manipulating the text. Let's see a few examples. -->

> This is the rthe first paragraph. <br>
> This is the second line. <br>
> <br>
> This is the second paragraph. <br>

Поместите курсор в самую верхнюю левую позицию, нажав `1G` и `|`, которые перемещают в первую строку и первый столбец соответственно.

Давайте рассмотрим первый случай: мы набрали лишнюю 'r', которую теперь необходимо удалить. Нажмите `3w`, чтобы перейти вперед на 3 слова.

Теперь нам нужно удалить один символ в текущей позиции курсора.

Обратите внимание, что это состоит из двух частей:

| Операция | Текстовый объект / Движение |
| --- | --- |
| Удаление | Один символ от текущей позиции курсора |
| `d` | `l` |

Итак, мы должны просто нажать `dl` и удалить один символ! Обратите внимание, что мы можем использовать `l`, даже если это движение.

Теперь мы замечаем, что весь мир избыточен, потому что у нас есть "свое" дважды. Теперь подумайте хорошенько о том, какая должна быть самая быстрая комбинация клавиш, чтобы исправить это?

Потратьте некоторое время, чтобы подумать и выяснить это для себя. Не торопитесь. А теперь читайте дальше.

| Операция | Текстовый объект / Движение |
| --- | --- |
| Удаление | Слово |
| `d` | `w` |

Итак, нажав `dw` вы удалите слово. Вуаля! Так просто и так красиво. Красота заключается в том, что такие простые концепции могут быть объединены, для обеспечения такого богатого спектра возможностей.

Как мы достигаем такой же операции для строк? Ну, строки считаются особенными в Vim, потому что строки - это обычно то, как мы думаем о нашем тексте. Сокращенно, если вы повторите имя операции дважды, она будет работать на строке. Таким образом, `dd` удалит текущую строку, а `yy` будет дергать текущую строку.

Наш пример текста в Vim теперь должен выглядеть так:

> This is the first paragraph. <br>
> This is the second line. <br>
> <br>
> This is the second paragraph.

Перейдите ко второй строке, нажав `j`. Теперь нажмите `dd` и строка должна быть удалена. Теперь вы должны увидеть:

> This is the first paragraph. <br>
> <br>
> This is the second paragraph.

Давайте посмотрим на более крупный случай: как выдернуть текущий абзац?

| Операция | Текстовый объект / Движение |
| --- | --- |
| Yank | Абзац |
| `y` | `ap` |

Итак, `yap` скопирует текущий абзац.

Теперь, когда мы завершили копирование текста, как мы можем вставить его? Просто `p`.

Теперь вы должны увидеть:

> This is the first paragraph. <br>
> This is the first paragraph. <br>
> <br>
> <br>
> This is the second paragraph.

Обратите внимание, что пустая строка также копируется, когда мы выполняем `yap`, поэтому `p` добавляет и эту дополнительную пустую строку.

Существует два типа вставки, которые можно сделать точно так же, как два вида вставок, которые мы видели ранее:

| Клавиша | Действие |
| --- | --- |
| `p` | Вставка после текущей позиции курсора |
| `P` | Вставка перед текущей позицией курсора |

Развивая эту идею дальше, мы можем объединить их в более мощные способы.

Как поменять местами два символа? Нажмите `хр`.

- `x` &rarr; удалить один символ в текущей позиции курсора
- `p` &rarr; вставить после текущей позиции курсора

Как поменять местами два слова? Нажмите `dwwP`.

- `d` &rarr; удалить
- `w` &rarr; одно слово
- `w` &rarr; переместить на следующее слово
- `P` &rarr; вставить перед текущей позицией курсора

Важно *не* заучивать эти операции наизусть. Эти комбинации действий и текстовых объектов/движений должны быть автоматизированы для ваших пальцев, без раздумий. Это происходит, когда вы делаете их использование привычкой.

## Разметка своей территории

Вы пишете, и вы вдруг понимаете, что нужно изменить предложения в предыдущем разделе, чтобы дополнить то, что вы пишете в этом разделе. Проблема в том, что вы должны помнить, где находитесь прямо сейчас, чтобы вернуться сюда позже. Неужели Vim не может запомнить это для меня? Это может быть реализовано с помощью меток.

Вы можете создать метку нажав `m`, а затем имя метки, которое является одним символом из `a-zA-Z`. Например, нажатие `ma` создает метку с именем "a".

Нажатие `'a` возвращает курсор к строке метки. Нажатие <code>`a</code> приведет вас к точной строке и столбцу метки.

Самое приятное, что вы можете перейти в эту позицию используя эти метки в любой момент после этого.

Смотрите `:help mark-motions` для более подробной информации.

## Time machine using undo/redo

Предположим, вы переписываете абзац, но в конечном итоге путаете то, что вы пытались переписать, и хотите вернуться к тому, что написали ранее. Здесь мы хотим "отменить" то, что только что сделали. Если мы хотим вернуться к тому, что у нас есть сейчас, мы можем "повторить" изменения, которые сделали. Обратите внимание, что изменение подразумевает некоторое изменение текста, оно не учитывает движения курсора и другие вещи, не связанные непосредственно с текстом.

Предположим, у вас есть текст:

> I have coined a phrase for myself - 'CUT to the G': <br>
> 1. Concentrate <br>
> 2. Understand <br>
> 3. Think <br>
> 4. Get Things Done <br>
> <br>
> Step 4 is eventually what gets you moving, but Steps 2 and 3 are equally important. As Abraham Lincoln once said "If I had eight hours to chop down a tree, I'd spend six hours sharpening my axe." And to get to this stage, you need to do Step 1 which boils down to one thing - It's all in the mind. That's why it's so hard.

Теперь начните редактирование первой строки:

1. Нажмите `S` для 's'ubstitute (замены всей строки.
2. Введите текст `After much thought, I have coined a new phrase to help me solidify my approach:`.
3. Нажмите `<esc>`.

А теперь подумайте об изменениях, которые мы только что совершили. Это предложение лучше? Хм, а может раньше текст был лучше? Как мы переключимся туда и обратно?

Нажмите `u` чтобы отменить последнее изменение и посмотреть что у нас было раньше. Теперь вы увидите текст `I have coined a phrase for myself - 'CUT to the G':`. Чтобы вернуться к последнему изменению, нажмите `ctrl-r` и теперь увидите строку `After much thought, I have coined a new phrase to help me solidify my approach:`.

Необходимо отметить, что Vim предоставляет неограниченную историю изменений отмены/повтора, но обычно она ограничена настройкой `undolevels` в Vim и объемом памяти на вашем компьютере.

Теперь давайте посмотрим на некоторые вещи, которые действительно демонстрируют расширенную функциональность отмены/повтора Vim, такие вещи, которым другие редакторы будут завидовать: Vim - это не только ваш редактор, но также машина времени.

Например, `:earlier 4m` вернет вас на 4 минуты назад, тоесть состояние текста 4 минутами "earlier" (ранее).

Сила здесь в том, что она превосходит все отмены и повторы. Например, если вы внесете изменение, а затем отмените, а после продолжите редактирование, это изменение фактически никогда не будет восстановлено снова с помощью простого `u`. Но это возможно в Vim с помощью команды `:earlier`.

Вы также можете шагнуть вперед во времени `:later 45s`, что займет у вас позже на 45 секунд. <!--нифига непонятно-->
<!--You can also go forward in time: `:later 45s` which will take you later by 45 seconds.-->

Или, если вы хотите более простой подход к возврату на 5 изменений: `:undo 5`.

Вы можете просмотреть дерево отмен, используя `:undolist`.

Смотрите `:help undolist` для объяснения выходных данных этой команды.

Смотрите `:help undo-redo` и `:help usr_32.txt` для более подробной информации.

## A powerful search engine but not a dotcom

Vim имеет мощный встроенный поисковик, который вы можете использовать чтобы найти именно то, что ищете. Нужно немного привыкнуть к силе, которую он предоставляет, так что давайте начнем.

Давайте вернемся к нашему знакомому примеру:

> I have coined a phrase for myself - 'CUT to the G': <br>
> 1. Concentrate <br>
> 2. Understand <br>
> 3. Think <br>
> 4. Get Things Done <br>
> <br>
> Step 4 is eventually what gets you moving, but Steps 2 and 3 are equally important. As Abraham Lincoln once said "If I had eight hours to chop down a tree, I'd spend six hours sharpening my axe." And to get to this stage, you need to do Step 1 which boils down to one thing - It's all in the mind. That's why it's so hard.

Предположим, мы хотим найти слово "Step". В обычном режиме, типа `/Step<cr>` (т.е. `/Step` затем клавиша `Enter`). Это приведет вас к первому появлению этого набора символов. Нажатие `n` переместит к следующему вхождению, и `N` - для противоположного направления, т.е. к предыдущему вхождению.

Что делать,если вы знали только часть фразы или не знаете точного написания? Не было бы полезно, если бы Vim мог начать поиск, как и когда вы вводите поисковую фразу? Вы можете включить это, запустив:

``` viml
set incsearch
```

Вы также можете указать Vim игнорировать регистр (нижний или верхний) текста, который вы ищете:

``` viml
set ignorecase
```

Или можете использовать:

``` viml
set smartcase
```

Если Вы используете `smartcase`, то:

- Если вы ищете `/step` т.е. текст, который вы вводите, находится в нижнем регистре, то он будет искать любую комбинацию верхнего и нижнего регистра текста. Например, этому будут соответствовать все следующие четыре - "Step", "Stephen","stepbrother", "misstep."
- Если вы ищете `/Step` т. е. текст, который вы вводите, имеет верхний регистр, то он будет искать **только** текст, который соответствует точному регистру. Например, он будет соответствовать "Step" и "Stephen", но не "steprother" или "misstep."

> Примечание: Я рекомендую вам поместить эти две строки в свой файл vimrc (объяснено позже, но см. `:help vimrc-intro` для быстрого Ознакомления), чтобы это всегда было включено.

Теперь, когда мы поняли основы поиска, давайте познаем его реальную силу. Первое, что необходимо отметить, это то, что вы предоставляете Vim, может быть не только простой фразой, но и "выражением". Выражение позволяет указать "виды" текста для поиска, а не только точный текст для поиска.

Например, вы заметите, что /step приводит вас к steps, а также step и даже footstep, если такое слово присутствует. Что делать, если вы хотите искать точное слово step, а не когда оно является частью любого другого слова? Для этого вы можете выполнить поиск с помощью `/\<step\>`. Где `\<` и
`\>` указывают начальную и конечную позиции "слова" соответственно.

Точно так же, что делать, если вы хотите найти число? Поиск пок `/\d` будет искать 'digit' (цифру). Но число - это всего лишь группа цифр вместе взятых. Поэтому мы указываем "одну или несколько" цифр вместе как `/\d\+`. Если мы ищем ноль или более символов, то можем использовать `*` вместо `+`.

Есть множество таких магических вещей, которые мы можем использовать в наших шаблонах поиска. Подробности смотрите в `:help pattern`.

## Резюме

Мы рассмотрели некоторые из основных команд редактирования, которые будем использовать в нашем повседневном использовании Vim. *Очень важно, чтобы вы снова повторили эти понятия и сделали их привычкой.* Не нужно изучать каждый вариант или нюансы этих команд. Если вы знаете, как использовать команду и знаете, как найти больше о том, что вам необходимо, то вы настоящий Vim'мер.

Теперь, идите вперед и начните редактирование!
